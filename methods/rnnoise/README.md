# RNNoise Environment Setup

This document describes how to set up the environment to run the RNNoise enhancement script using the C library via CFFI.

## Prerequisites

- A C compiler (like GCC or Clang)
- `automake`, `autoconf`, `libtool` (install via package manager, e.g., `brew install automake autoconf libtool` on macOS, `sudo apt-get install automake autoconf libtool` on Debian/Ubuntu)

## Conda Environment

It's recommended to use a Conda environment.

1.  **Create Conda environment**:
    ```bash
    conda create -n rnnoise python=3.9 # Or your preferred version
    ```

2.  **Activate environment**:
    ```bash
    conda activate rnnoise
    ```

## Build RNNoise C Library

1.  **Clone the RNNoise repository**:
    ```bash
    cd lib
    git clone https://github.com/xiph/rnnoise.git
    cd rnnoise
    ```

2.  **Build the library**:
    ```bash
    ./autogen.sh
    ./configure
    make
    ```
    This will create the shared library (e.g., `.libs/librnnoise.so` on Linux, `.libs/librnnoise.dylib` on macOS).

3.  **Return to the method directory**:
    ```bash
    cd ../.. # Back to methods/rnnoise
    ```

## Build CFFI Wrapper

1.  **Install Python dependencies**:
    ```bash
    pip install -r requirements.txt
    ```

2.  **(Optional but Recommended) Create CFFI Build Script (`build_rnnoise_cffi.py`)**:
    Create a Python script (`build_rnnoise_cffi.py`) in the `methods/rnnoise` directory to define the C interface and compile the CFFI module. (This script will be created in a later step if not present).

3.  **Run the CFFI build script**:
    ```bash
    python build_rnnoise_cffi.py
    ```
    This will generate a Python extension module (e.g., `_rnnoise_cffi.*.so` or `_rnnoise_cffi.*.pyd`) that allows Python to call the C library.

## Running the script

Once the environment is set up, dependencies are installed, and the CFFI module is built, you can run the enhancement script:

```bash
# On macOS, you might need to tell Python where to find the C library:
export DYLD_LIBRARY_PATH=$(pwd)/lib/rnnoise/.libs:$DYLD_LIBRARY_PATH

# On Linux:
# export LD_LIBRARY_PATH=$(pwd)/lib/rnnoise/.libs:$LD_LIBRARY_PATH

python run.py --input-dir ../../assets/prepared --output-dir ./output
```

Make sure the input directory contains the prepared `_16k.wav` files generated by the root `preparation.py` script. 